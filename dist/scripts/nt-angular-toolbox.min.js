/*! nt-angular-toolbox - v0.4.2 - 2015-02-18
* Copyright (c) 2015 Williams Torres (wtorres@nectia.com); Licensed MIT */
(function(){
!function(){"use strict";function a(a){return{restrict:"E",transclude:!0,template:a.getConfiguration().template,replace:!0}}function b(a){function b(b,c){c.html(b.template),a(c.contents())(b.controller)}return{restrict:"A",replace:!0,scope:{template:"@ntModalTemplate",controller:"@"},link:b}}function c(a){function b(b,c){b.pagination={actualPage:1,totalPages:1,nroRows:10},b.load=function(){b.pagination.totalPages=0===b.data.length?1:Math.round(b.data.length/b.pagination.nroRows);var a=(b.pagination.actualPage-1)*b.pagination.nroRows,c=b.pagination.actualPage*b.pagination.nroRows;b.filteredData=b.data.slice(a,c)},b.$watch(b.data,function(){b.data&&b.load()},!0),c.html('<nt-pagination actual-page="pagination.actualPage" total-pages="pagination.totalPages" nro-rows="pagination.nroRows" load="load()" ></nt-pagination>'),a(c.contents())(b)}return{restrict:"E",scope:{data:"=",filteredData:"="},replace:!0,link:b}}function d(a,b,c){function d(d,e){c.getTemplate().then(function(b){e.html(b),a(e.contents())(d)}),d.changePagination=function(a){d.nroRows!==a&&b(function(){d.nroRows=a,d.$apply(),d.load()})},d.nextPage=function(){d.actualPage<d.totalPages&&b(function(){d.actualPage++,d.$apply(),d.load()})},d.previousPage=function(){d.actualPage>1&&b(function(){d.actualPage--,d.$apply(),d.load()})}}return{restrict:"E",scope:{actualPage:"=",totalPages:"=",nroRows:"=",load:"&"},replace:!0,link:d}}function e(){function a(){var a=angular.element(c.configuration.template);a.attr("ng-transclude",""),c.configuration.template=a[0].outerHTML}function b(a,b,e,g,h,i,j,k,l){function m(a){a.scope.$destroy(),a.modal.remove(),d.splice(d.indexOf(a),1),j.hide(),0===d.length&&(c.zIndex=c.configuration.initiaIndex)}return{open:function(n){function o(b){p.append(b),a(p)(q)}var p=angular.element(document.createElement("nt-modal")),q=i.$new(),r={};n.templateUrl?r.template=l(n.templateUrl,!0).then(o):o(n.template),j.show(c.zIndex+1),c.zIndex=c.zIndex+2,p.css("z-index",c.zIndex);var s=new f(b,e,g,q,p,m);d.push(s);var t=angular.extend({},n.resolve);return angular.forEach(t,function(a,b){t[b]=angular.isString(a)?k.get(a):k.invoke(a,null,null,b)}),b.all(angular.extend({},t,r)).then(function(){h(n.controller,angular.extend({$scope:q,modalInstance:s.service},t)),angular.element(document.body).append(p)}),s.getPromise()},destroyModal:m,getConfiguration:function(){return c.configuration}}}var c=this,d=[];this.configuration={initiaIndex:1e3,template:'<div class="modal"></div>'},a(),this.setConfig=function(b){angular.extend(this.configuration,b),this.configuration.templateUrl||a(),this.zIndex=this.configuration.initiaIndex},this.zIndex=this.configuration.initiaIndex,b.$inject=["$compile","$q","$window","$timeout","$controller","$rootScope","ntOverlayService","$injector","$templateRequest"],this.$get=b}function f(a,b,c,d,e,f){var g=this,h=a.defer();this.scope=d,this.modal=e,this.service={resolve:function(a){f(g),h.resolve(a)},reject:function(a){f(g),h.reject(a)},updatePosition:function(){c(function(){angular.element(b).triggerHandler("resize")})}},this.getPromise=function(){return h.promise}}function g(){function a(){b.css("z-index",c[c.length-1])}var b,c=[];this.show=function(d){void 0===b&&(b=angular.element(document.createElement("div")),b.addClass("palette-overlay"),angular.element(document.body).append(b)),c.push(d),a()},this.hide=function(){c.pop(),0===c.length?(b.remove(),b=void 0):a()}}function h(){function a(a,b){var c=this;return{getTemplate:function(){var d=a.defer();return angular.isUndefined(c.templateUrl)||c.loaded?d.resolve(c.template):b.get(url).then(function(a){c.loaded=!0,c.template=a,d.resolve(c.template)},function(){throw"Error al cargar el template: "+attrs.templateUrl}),d.promise}}}this.loaded=!1,this.template='<div data-tool="tablePagination"><ul class="tp-quantity-selector"><li><a ng-class="{active: nroRows == 100}" ng-click="changePagination(100)" data-quantity="100">100</a></li><li><a ng-class="{active: nroRows == 50}" ng-click="changePagination(50)" data-quantity="50">50</a></li><li><a ng-class="{active: nroRows == 10}" ng-click="changePagination(10)" data-quantity="10">10</a></li></ul><ul class="tp-page-navigator"><li><a ng-click="nextPage()" data-action="tablePageForward" data-icon="table-nav-right"></a></li><li><a ng-click="previousPage()" data-action="tablePageBackward" data-icon="table-nav-left"></a></li></ul><span class="tp-page-indicator"> {{actualPage}} / {{totalPages}} </span></div>',this.setTemplate=function(a){this.template=a},this.setTemplateUrl=function(a){this.templateUrl=a},a.$inject=["$q","$http"],this.$get=a}var i=angular.module("nt.angular.toolbox",[]);a.$inject=["ntModalService"],i.directive("ntModal",a),b.$inject=["$compile"],i.directive("ntModalTemplate",b),c.$inject=["$compile"],i.directive("ntPaginationClient",c),d.$inject=["$compile","$timeout","paginationService"],i.directive("ntPagination",d),i.provider("ntModalService",e),i.service("ntOverlayService",g),i.provider("paginationService",h)}();